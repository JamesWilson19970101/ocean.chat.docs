<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-devdocs/JWT" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">JWT Hybrid Authentication | oceanchat-devdocs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://JamesWilson19970101.github.io/ocean.chat.docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://JamesWilson19970101.github.io/ocean.chat.docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://JamesWilson19970101.github.io/ocean.chat.docs/docs/devdocs/JWT"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_CN"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="JWT Hybrid Authentication | oceanchat-devdocs"><meta data-rh="true" name="description" content="In modern web applications and microservices architectures, authentication is the cornerstone of the security system. JWT (JSON Web Token) based authentication is widely adopted due to its stateless, scalable, and cross-domain-friendly features. However, a single, long-lived JWT token has inherent risks in terms of security and flexibility."><meta data-rh="true" property="og:description" content="In modern web applications and microservices architectures, authentication is the cornerstone of the security system. JWT (JSON Web Token) based authentication is widely adopted due to its stateless, scalable, and cross-domain-friendly features. However, a single, long-lived JWT token has inherent risks in terms of security and flexibility."><link data-rh="true" rel="icon" href="/ocean.chat.docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://JamesWilson19970101.github.io/ocean.chat.docs/docs/devdocs/JWT"><link data-rh="true" rel="alternate" href="https://JamesWilson19970101.github.io/ocean.chat.docs/docs/devdocs/JWT" hreflang="en"><link data-rh="true" rel="alternate" href="https://JamesWilson19970101.github.io/ocean.chat.docs/zh-CN/docs/devdocs/JWT" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://JamesWilson19970101.github.io/ocean.chat.docs/docs/devdocs/JWT" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/ocean.chat.docs/blog/rss.xml" title="oceanchat-devdocs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ocean.chat.docs/blog/atom.xml" title="oceanchat-devdocs Atom Feed"><link rel="stylesheet" href="/ocean.chat.docs/assets/css/styles.b4e89eac.css">
<script src="/ocean.chat.docs/assets/js/runtime~main.af7ee79d.js" defer="defer"></script>
<script src="/ocean.chat.docs/assets/js/main.b4d63f0d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/ocean.chat.docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ocean.chat.docs/"><div class="navbar__logo"><img src="/ocean.chat.docs/img/logo.svg" alt="oceanchat Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/ocean.chat.docs/img/logo.svg" alt="oceanchat Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ocean Chat</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ocean.chat.docs/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/ocean.chat.docs/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/ocean.chat.docs/docs/devdocs/JWT" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/ocean.chat.docs/zh-CN/docs/devdocs/JWT" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">简体中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/JamesWilson19970101" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ocean.chat.docs/docs/intro">OceanChat Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/ocean.chat.docs/docs/category/oceanchat---userdocs">oceanchat - userdocs</a><button aria-label="Expand sidebar category &#x27;oceanchat - userdocs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/ocean.chat.docs/docs/category/oceanchat---devdocs">oceanchat - devdocs</a><button aria-label="Collapse sidebar category &#x27;oceanchat - devdocs&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/manage-docs-versions">Manage Docs Versions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/translate-your-site">Translate your site</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/Auth Service">Auth Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ocean.chat.docs/docs/devdocs/JWT">JWT Hybrid Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/cache">cache issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/concurrency considerations">concurrency considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/file structure">file structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/graphql vs http in oceanchat">graphql vs http in oceanchat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ocean.chat.docs/docs/devdocs/microservice">Microservice Architecture</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/ocean.chat.docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/ocean.chat.docs/docs/category/oceanchat---devdocs"><span itemprop="name">oceanchat - devdocs</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">JWT Hybrid Authentication</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>JWT Hybrid Authentication</h1></header>
<p>In modern web applications and microservices architectures, authentication is the cornerstone of the security system. JWT (JSON Web Token) based authentication is widely adopted due to its stateless, scalable, and cross-domain-friendly features. However, a single, long-lived JWT token has inherent risks in terms of security and flexibility.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Core Idea</div><div class="admonitionContent_BuS1"><p>This platform adopts a <strong>JWT Hybrid Mode Authentication Strategy</strong>. This strategy combines the use of a short-lived <code>Access Token</code> and a long-lived <code>Refresh Token</code>, implementing defense-in-depth at every stage to achieve the best balance between high performance, high security, and excellent user experience.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="access-token-at">Access Token (AT)<a href="#access-token-at" class="hash-link" aria-label="Direct link to Access Token (AT)" title="Direct link to Access Token (AT)">​</a></h2>
<ul>
<li>
<p><strong>Role</strong>: The &quot;pass&quot; for clients to access protected resources. It is a high-frequency use token.</p>
</li>
<li>
<p><strong>Characteristics</strong>:</p>
<ul>
<li><strong>Short-lived</strong>: The validity period is extremely short, planned to be <strong>5 to 15 minutes</strong>.</li>
<li><strong>Stateless Validation</strong>: The server only needs to verify its signature and expiration to trust its content, without querying the database. This ensures extremely high processing performance.</li>
<li><strong>Risk</strong>: Due to its high frequency of use and transmission, the risk of theft is relatively high. Its short lifespan is key to mitigating this risk.</li>
</ul>
</li>
<li>
<p><strong>Payload</strong>: Contains non-sensitive user identity information, such as user ID, roles, etc., following the principle of least privilege.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="refresh-token-rt">Refresh Token (RT)<a href="#refresh-token-rt" class="hash-link" aria-label="Direct link to Refresh Token (RT)" title="Direct link to Refresh Token (RT)">​</a></h2>
<ul>
<li>
<p><strong>Role</strong>: The sole credential for obtaining a new Access Token. It can be seen as the &quot;session key&quot; that maintains the user&#x27;s login state. It is a low-frequency use token.</p>
</li>
<li>
<p><strong>Characteristics</strong>:</p>
<ul>
<li><strong>Long-lived</strong>: The validity period is longer, planned to be <strong>7 to 30 days</strong>.</li>
<li><strong>Stateful Validation</strong>: When processing an RT, the server must query the database or cache to verify if it is still valid. This provides the ability to revoke sessions.</li>
<li><strong>Risk</strong>: Once leaked, it can lead to severe security consequences. Therefore, it must be protected with the strictest storage and transmission measures.</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hybrid-mode">Hybrid Mode<a href="#hybrid-mode" class="hash-link" aria-label="Direct link to Hybrid Mode" title="Direct link to Hybrid Mode">​</a></h2>
<p>The core idea of this mode is to separate authentication responsibilities:</p>
<ul>
<li>
<p><strong>Daily Access (99% of scenarios)</strong>: Use stateless, high-performance Access Tokens.</p>
</li>
<li>
<p><strong>Session Renewal (1% of scenarios)</strong>: Use stateful, high-security Refresh Tokens.</p>
</li>
</ul>
<p>This design allows the system to respond quickly in most cases while retaining the ability to perform strict security checks at critical moments (like session refresh, logout).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-strategy">Security Strategy<a href="#security-strategy" class="hash-link" aria-label="Direct link to Security Strategy" title="Direct link to Security Strategy">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure-token-generation--configuration">Secure Token Generation &amp; Configuration<a href="#secure-token-generation--configuration" class="hash-link" aria-label="Direct link to Secure Token Generation &amp; Configuration" title="Direct link to Secure Token Generation &amp; Configuration">​</a></h3>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Isolate Secrets</div><div class="admonitionContent_BuS1"><p>The Access Token and Refresh Token <strong>must</strong> be signed with two completely different and sufficiently complex secrets (<code>JWT_ACCESS_SECRET</code> and <code>JWT_REFRESH_SECRET</code>) to prevent one from being inferred from the other.</p></div></div>
<p><strong>Minimize Payload</strong>: The Access Token payload <strong>must not</strong> contain any sensitive information (such as passwords, phone numbers, detailed permissions, etc.). It should only contain necessary identifiers (like <code>userId</code>) and roles.</p>
<p><strong>Reasonable Expiration</strong>:</p>
<ul>
<li>AT: <code>15m</code> (15 minutes).</li>
<li>RT: <code>7d</code> (7 days).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure-client-side-storage">Secure Client-Side Storage<a href="#secure-client-side-storage" class="hash-link" aria-label="Direct link to Secure Client-Side Storage" title="Direct link to Secure Client-Side Storage">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="access-token">Access Token<a href="#access-token" class="hash-link" aria-label="Direct link to Access Token" title="Direct link to Access Token">​</a></h4>
<p><strong>Preferred: Store in JavaScript memory variables</strong>. This is the most secure method as it does not persist between browser sessions and is completely immune to CSRF attacks.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Advantages</div><div class="admonitionContent_BuS1"><ul>
<li><strong>Extremely High Security</strong>: This is the best way to defend against XSS (Cross-Site Scripting) attacks. Because the token is stored in a JavaScript variable, even if an attacker can inject a script, they cannot directly and persistently read it like they could with <code>sessionStorage</code> or <code>localStorage</code>.</li>
<li><strong>No CSRF Risk</strong>: Since the token needs to be manually added to the <code>Authorization</code> request header via JavaScript, the browser does not automatically include it, making it completely immune to CSRF (Cross-Site Request Forgery) attacks.</li>
<li><strong>Minimal Attack Window</strong>: Once the user closes the tab or refreshes the page, the memory variable is cleared, and the token disappears immediately. This means even if the token is stolen at some point, its lifespan is extremely short.</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Disadvantages</div><div class="admonitionContent_BuS1"><ul>
<li><strong>Poor User Experience</strong>: This is the biggest drawback. Every time a user refreshes the page or opens a new tab to access your application, the Access Token in memory is lost. This forces the application to immediately use the Refresh Token to get a new Access Token, increasing the frequency of requests to the <code>/refresh</code> endpoint. If the network is poor, the user may feel a noticeable &quot;reload&quot; or &quot;lag&quot;.</li>
</ul></div></div>
<p><strong>Secondary: Store in <code>sessionStorage</code></strong>. It persists on page refresh but is cleared when the browser window is closed.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Advantages</div><div class="admonitionContent_BuS1"><ul>
<li><strong>Better User Experience</strong>: It can persist within a single tab&#x27;s session. After a user refreshes the page, the token is still valid, and the application can immediately restore its state without needing to request a new token.</li>
<li><strong>Isolation</strong>: <code>sessionStorage</code> is tab-based. The data is cleared when the tab is closed and is not stored permanently like <code>localStorage</code>.</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Disadvantages</div><div class="admonitionContent_BuS1"><ul>
<li><strong>Vulnerable to XSS</strong>: This is its biggest security vulnerability compared to in-memory storage. If your site has an XSS vulnerability, an attacker&#x27;s injected script can easily read the token via <code>sessionStorage.getItem(&#x27;accessToken&#x27;)</code> and send it to their own server.</li>
</ul></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="refresh-token">Refresh Token<a href="#refresh-token" class="hash-link" aria-label="Direct link to Refresh Token" title="Direct link to Refresh Token">​</a></h4>
<p><strong>Store in an <code>HttpOnly</code> browser Cookie.</strong></p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Cookie Attributes</div><div class="admonitionContent_BuS1"><ul>
<li><code>HttpOnly</code>: This flag prevents any client-side JavaScript from accessing the cookie, fundamentally stopping XSS attacks from stealing the RT.</li>
<li><code>Secure</code>: This flag forces the browser to only send the cookie over HTTPS connections.</li>
<li><code>SameSite=Strict</code> or <code>Lax</code>: This flag helps defend against CSRF (Cross-Site Request Forgery) attacks.</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure-token-transmission">Secure Token Transmission<a href="#secure-token-transmission" class="hash-link" aria-label="Direct link to Secure Token Transmission" title="Direct link to Secure Token Transmission">​</a></h3>
<p><strong>Enforce HTTPS</strong>: All authentication-related endpoints, and the entire application, <strong>must</strong> be forced to use HTTPS (TLS) encryption. This prevents tokens from being intercepted by Man-in-the-Middle (MITM) attacks during transmission.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure-token-rotation--validation">Secure Token Rotation &amp; Validation<a href="#secure-token-rotation--validation" class="hash-link" aria-label="Direct link to Secure Token Rotation &amp; Validation" title="Direct link to Secure Token Rotation &amp; Validation">​</a></h3>
<p><strong>Refresh Token Rotation</strong>: This is the core mechanism for detecting RT theft.</p>
<ol>
<li>When a client uses an RT (<code>RT_A</code>) to refresh, the server, upon successful validation, returns both a new AT (<code>AT_B</code>) and a brand new RT (<code>RT_B</code>).</li>
<li>The server immediately marks the old <code>RT_A</code> as used or invalid.</li>
</ol>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Replay Attack Detected</div><div class="admonitionContent_BuS1"><p>If the server later receives another refresh request with <code>RT_A</code>, it means the token may have been stolen (an attacker is replaying the old token). In this case, the server should immediately invalidate all sessions for that user, forcing them to re-login on all devices.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure-session-termination">Secure Session Termination<a href="#secure-session-termination" class="hash-link" aria-label="Direct link to Secure Session Termination" title="Direct link to Secure Session Termination">​</a></h3>
<p><strong>User Logout</strong>: When a user logs out, the client should actively request the <code>/logout</code> endpoint. Upon receiving the request, the server must clear the corresponding RT hash stored in the database, thus invalidating the RT immediately.</p>
<p><strong>Force Logout from All Devices</strong>: Provide a &quot;Security Settings&quot; option that allows the user to clear all RT records associated with their account, achieving a one-click sign-out.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">Workflow<a href="#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-initial-login">Step 1: Initial Login<a href="#step-1-initial-login" class="hash-link" aria-label="Direct link to Step 1: Initial Login" title="Direct link to Step 1: Initial Login">​</a></h4>
<p><strong>Client</strong>: User enters username and password on the login page and clicks login.</p>
<p><strong>Server</strong>:</p>
<ol>
<li>Validate the credentials.</li>
<li>If correct, generate a pair of tokens:<!-- -->
<ul>
<li>A short-lived Access Token (<code>AT_A</code>).</li>
<li>A long-lived Refresh Token (<code>RT_A</code>).</li>
</ul>
</li>
<li>Hash <code>RT_A</code> and store the hash (<code>Hashed_RT_A</code>) in the corresponding user record in the database.</li>
<li>Send the tokens back to the client via HTTP response:<!-- -->
<ul>
<li><code>AT_A</code> is placed in the response body (JSON Body).</li>
<li><code>RT_A</code> is placed in a <code>Set-Cookie</code> response header with the <code>HttpOnly; Secure; SameSite=Strict</code> flags.</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-accessing-protected-resources">Step 2: Accessing Protected Resources<a href="#step-2-accessing-protected-resources" class="hash-link" aria-label="Direct link to Step 2: Accessing Protected Resources" title="Direct link to Step 2: Accessing Protected Resources">​</a></h4>
<p><strong>Client</strong>:</p>
<ol>
<li>Stores <code>AT_A</code> from the response body in memory.</li>
<li>Includes <code>AT_A</code> in the <code>Authorization: Bearer &lt;AT_A&gt;</code> header for every request to a protected API.</li>
</ol>
<p><strong>Server</strong>:</p>
<ol>
<li>Receives the request and extracts <code>AT_A</code>.</li>
<li>Performs a quick, stateless validation (checks signature and expiration).</li>
<li>If valid, processes the request and returns data.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-access-token-expiration--refresh">Step 3: Access Token Expiration &amp; Refresh<a href="#step-3-access-token-expiration--refresh" class="hash-link" aria-label="Direct link to Step 3: Access Token Expiration &amp; Refresh" title="Direct link to Step 3: Access Token Expiration &amp; Refresh">​</a></h4>
<p><strong>Client</strong>: Makes an API request with an expired <code>AT_A</code>.</p>
<p><strong>Server</strong>: Validates <code>AT_A</code>, finds it has expired, rejects the request, and returns a <code>401 Unauthorized</code> status code.</p>
<p><strong>Client (Request Interceptor)</strong>:</p>
<ol>
<li>Automatically catches the <code>401</code> error.</li>
<li>Automatically sends a request to the server&#x27;s <code>/auth/refresh</code> endpoint(server response should include path). The browser will automatically include the <code>RT_A</code> stored in the <code>HttpOnly</code> cookie.</li>
</ol>
<p><strong>Server (<code>/auth/refresh</code> endpoint)</strong>:</p>
<ol>
<li>Gets <code>RT_A</code> from the cookie.</li>
<li>Performs <strong>stateful validation</strong>:<!-- -->
<ul>
<li>Checks the signature and expiration of <code>RT_A</code>.</li>
<li>Extracts <code>userId</code> from the <code>RT_A</code> payload.</li>
<li>Queries the database using <code>userId</code> to get the stored <code>Hashed_RT_A</code>.</li>
<li>Compares the hash of the received <code>RT_A</code> with <code>Hashed_RT_A</code>.</li>
</ul>
</li>
<li><strong>Validation Succeeded (Token Rotation)</strong>:<!-- -->
<ul>
<li>Generate a brand new pair of tokens: <code>AT_B</code> and <code>RT_B</code>.</li>
<li>Hash <code>RT_B</code> and use the new <code>Hashed_RT_B</code> to overwrite <code>Hashed_RT_A</code> in the database.</li>
<li>Return <code>AT_B</code> and the new <code>RT_B</code> (via <code>HttpOnly</code> cookie) to the client.</li>
</ul>
</li>
<li><strong>Validation Failed</strong>: Return <code>403 Forbidden</code>, indicating an invalid session.</li>
</ol>
<p><strong>Client (Request Interceptor)</strong>:</p>
<ol>
<li>Upon receiving the new <code>AT_B</code>, updates the Access Token in memory.</li>
<li>Automatically retries the API request that just failed with a <code>401</code>.</li>
<li>If a <code>403</code> is received, clears all local state and redirects the user to the login page.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-4-logout">Step 4: Logout<a href="#step-4-logout" class="hash-link" aria-label="Direct link to Step 4: Logout" title="Direct link to Step 4: Logout">​</a></h4>
<p><strong>Client</strong>: User clicks the logout button, sending a request to the <code>/auth/logout</code> endpoint.</p>
<p><strong>Server</strong>:</p>
<ol>
<li>Identifies the user via the Access Token.</li>
<li>Finds the user&#x27;s record in the database and sets their <code>hashedRefreshToken</code> field to <code>null</code>.</li>
<li>Sends a <code>Set-Cookie</code> header in the response to clear the <code>HttpOnly</code> cookie.</li>
</ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/ocean.chat.docs/docs/devdocs/Auth Service"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Auth Service</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ocean.chat.docs/docs/devdocs/cache"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">cache issues</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#access-token-at" class="table-of-contents__link toc-highlight">Access Token (AT)</a></li><li><a href="#refresh-token-rt" class="table-of-contents__link toc-highlight">Refresh Token (RT)</a></li><li><a href="#hybrid-mode" class="table-of-contents__link toc-highlight">Hybrid Mode</a></li><li><a href="#security-strategy" class="table-of-contents__link toc-highlight">Security Strategy</a><ul><li><a href="#secure-token-generation--configuration" class="table-of-contents__link toc-highlight">Secure Token Generation &amp; Configuration</a></li><li><a href="#secure-client-side-storage" class="table-of-contents__link toc-highlight">Secure Client-Side Storage</a></li><li><a href="#secure-token-transmission" class="table-of-contents__link toc-highlight">Secure Token Transmission</a></li><li><a href="#secure-token-rotation--validation" class="table-of-contents__link toc-highlight">Secure Token Rotation &amp; Validation</a></li><li><a href="#secure-session-termination" class="table-of-contents__link toc-highlight">Secure Session Termination</a></li></ul></li><li><a href="#workflow" class="table-of-contents__link toc-highlight">Workflow</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ocean.chat.docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ocean.chat.docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Ocean Chat, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>